<div class="grid gap-2">

  @if (authStore.isManager()) {
    <div class="border border-gary-200 rounded-lg p-4 h-fit">
      <h2 class="text-xl font-bold">Informations générales</h2>
      <div class="flex items-center overflow-x-auto scroll-smooth max-w-full gap-3 py-3 custom-scrollbar ">
        @for (info of generalInfo; track $index) {
          <div class="bg-gray-100 rounded-lg p-3 shadow-sm">
            <p class="text-sm text-gray-700 mb-1">{{ info.title }}</p>
            <p class="text-xl font-bold">
              @if (info?.currency) {
                {{ info.value() | vola }}
              } @else {
                {{ info.value() }}
              }  </p>
          </div>
        }
      </div>
    </div>

    <div class="border border-gary-200 rounded-lg p-4 grid gap-3">
      <h2 class="text-xl font-bold">Statistiques</h2>
      <div class="grid gap-y-10 px-7">
        <div>
          <h3 class="text-lg font-semibold">Prestations effectuées</h3>

          @if (isAttendanceChartBlank()) {
            <canvas baseChart class="w-full"
                    [type]="'line'"
                    [data]="lineChartData"
                    [options]="lineChartOptions"
                    [legend]="lineChartLegend"
            >
            </canvas>
          } @else {
            <div class=" inline-flex justify-center w-full"> Rien à afficher pour le moment ...</div>
          }
        </div>

        <div>
          <h3 class="text-lg font-semibold">Top services</h3>

          @if (isServicesChartBlank()) {
            <canvas baseChart class="w-1/2"
                    [type]="'pie'"
                    [data]="pieChartData"
                    [options]="pieChartOptions"
                    [legend]="pieChartLegend">
            </canvas>
          } @else {
            <div class=" inline-flex justify-center w-full"> Rien à afficher pour le moment ...</div>
          }

        </div>
      </div>
    </div>
  }

  @if (authStore.isMechanic()) {
    <div class="rounded-lg col-span-12">
      <div class="block lg:hidden">
        <select #typeSelect class="w-full p-2 border rounded-lg" (change)="selectedCardType = typeSelect.value">
          <option value="pending">Demande de créneau</option>
          <option value="approved">Créneau approuvé</option>
          <option value="in_progress">En cours</option>
        </select>
      </div>

      <div class="hidden lg:grid lg:grid-cols-3 gap-2">
        <appointment-card
          [appointments]="pendingAppointments"
          title="Demande de créneau"
          color="#9CA3AF"
          emptyMessage="Aucune demande de créneau en attente"
          (onFixDate)="setAppointmentDate($event)"
          type="pending">
        </appointment-card>

        <appointment-card
          [appointments]="confirmedAppointments"
          title="En attente"
          color="#FFA500FF"
          emptyMessage="Aucun créneau approuvé pour le moment"
          (onBegin)="markAsInProgress($event)"
          type="approved">
        </appointment-card>

        <appointment-card
          [appointments]="inProgressAppointments"
          title="En cours"
          color="#2563EB"
          emptyMessage="Aucun vehicule en cours de traitement"
          (onCompleted)="markAsCompleted($event)"
          type="in_progress">
        </appointment-card>
      </div>

      <div class="block lg:hidden">
        @if (selectedCardType === 'pending' || !selectedCardType) {
          <appointment-card
            [appointments]="pendingAppointments"
            title="Demande de créneau"
            color="#9CA3AF"
            emptyMessage="Aucune demande de créneau en attente"
            (onFixDate)="setAppointmentDate($event)"
            type="pending">
          </appointment-card>
        }

        @if (selectedCardType === 'approved') {
          <appointment-card
            [appointments]="confirmedAppointments"
            title="Créneau approuvé"
            color="#16A34A"
            emptyMessage="Aucun créneau approuvé actuellement"
            (onBegin)="markAsInProgress($event)"
            type="approved">
          </appointment-card>
        }

        @if (selectedCardType === 'in_progress') {
          <appointment-card
            [appointments]="inProgressAppointments"
            title="En cours"
            color="#2563EB"
            emptyMessage="Aucun rendez-vous en cours"
            (onCompleted)="markAsCompleted($event)"
            type="in_progress">
          </appointment-card>
        }
      </div>
    </div>
  }
</div>
